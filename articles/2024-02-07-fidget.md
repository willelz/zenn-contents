---
title: "æ–°ã—ããªã£ãŸfidget.nvim"
emoji: "ğŸª…"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["neovim"]
published: true
published_at: 2024-02-07
---

## ã¯ã˜ã‚ã«

:::message
ã“ã®è¨˜äº‹ã¯[Vimé§…ä¼](https://vim-jp.org/ekiden/)ã®2æœˆ7æ—¥ã®è¨˜äº‹ã§ã™ã€‚
å‰å›ã¯kyoh86ã•ã‚“ã®[ã€Œdenoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜ã¯ç©æ¥µçš„ã«æ›´æ–°ã—ã¦ã„ããŸã„ã€](https://zenn.dev/vim_jp/articles/ae7c09bc446b60)ã§ã—ãŸã€‚
æ¬¡å›ã¯ãŠã¨ã‹ã•ã‚“ã®[ã€ŒVimã§è‡ªå‹•åŒ–ã‚’æ¥µã‚ã‚‹ï¼šå…¥é–€è€…å‘ã‘autocmdã‚¬ã‚¤ãƒ‰ã€](https://zenn.dev/garchomp_game/articles/12201d1b53c7fe)ã§ã™ã€‚
:::

ä»Šã¾ã§LSPã®èª­ã¿è¾¼ã¿ä¸­ã«å³ä¸‹ã§ãã‚‹ãã‚‹ã™ã‚‹ã‚„ã¤ãã‚‰ã„ã®èªè­˜ã§fidget.nvimã‚’å…¥ã‚Œã¦ã„ã¾ã—ãŸã€‚
ã‚ã‚‹æ—¥Githubã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ã„ã¤ã®é–“ã«ã‹èª¬æ˜ãŒ`Extensible UI for Neovim notifications and LSP progress messages.`ã¨ãªã£ã¦ãŠã‚ŠLSPå°‚ç”¨ã§ã¯ãªããªã£ã¦ã„ã¾ã—ãŸã€‚[^1]
å³ä¸‹ã«å¥½ããªé€šçŸ¥ã‚„é€²æ—æƒ…å ±ã‚’è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ãªã®ã§è©¦ã—ã¦ã¿ã¾ã™ã€‚
[^1]:æœ€è¿‘æ›¸ãç›´ã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚https://github.com/j-hui/fidget.nvim/issues/131

è‡ªç”±ã«ä½¿ç”¨ã§ãã‚‹ã¨ã„ã†ã ã‘ã§ä»Šã¾ã§é€šã‚Š`require("fidget").setup{}`ã‚’æ›¸ã„ã¦ãŠã‘ã°LSPã®æƒ…å ±ã¯è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## Progress

ãƒ˜ãƒ«ãƒ—ã¯`:h fidget.progress.handle`ã«è¼‰ã£ã¦ã„ã¾ã™ã€‚
ä½¿ã„æ–¹ã¯ã€`handle.create()` â†’ `ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã®æ›´æ–°` â†’`finish()` ã¨ç°¡å˜ã§ã™ã€‚
ä»¥ä¸‹ã®ä¾‹ã§ã¯10ç§’é–“ã‚¹ãƒ”ãƒŠãƒ¼ã‚’çœºã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```lua
local endTime = 10

function CountUp()
  local timer = vim.uv.new_timer()
  local now = 0

  local progress = require('fidget.progress').handle.create({
    title = '10 Count',
    lsp_client = { name = 'Counter' },
    message = tostring(now),
    percentage = 0
  })

  -- 1ç§’ã”ã¨ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¿ã‚¤ãƒãƒ¼
  timer:start(0, 1000, function()
    progress:report({ message = tostring(now), percentage = now / endTime * 100 })
    if (endTime <= now) then
      timer:close()
      progress:finish()
    end
    now = now + 1
  end)
end
```

![](/images/fidget/count.png)

ã“ã“ã§ã¯è¡¨ç¤ºã‚’ã„ã˜ã£ã¦ã„ã¾ã›ã‚“ãŒã€ã‚¹ãƒ”ãƒŠãƒ¼ã‚„ãƒã‚¤ãƒ©ã‚¤ãƒˆç­‰ãŸãã•ã‚“ã®è¨­å®šé …ç›®ãŒã‚ã‚Šã¾ã™ã€‚

## Notification

ãƒ˜ãƒ«ãƒ—ã¯`:h fidget.notification`ã§ã™ã€‚

```lua
fidget.notify({msg}, {level}, {opts})
```

msgã¯è¡¨ç¤ºã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚
levelã¯`:h vim.log.levels`ã«è¼‰ã£ã¦ã„ã¦INFOã‚„ERRORãªã©ãŒã‚ã‚Šã¾ã™ã€‚
optsã¯ã®è©³ç´°ã¯`:h fidget.notification.Options`ã«ã‚ã‚Šã¾ã™ã€‚


```vim
nnoremap <Space>n <cmd>lua require("fidget").notify('fidget!', vim.log.levels.INFO, {})<CR>
```

![](/images/fidget/notify.png)

ã“ã¡ã‚‰ã‚‚è¡¨ç¤ºã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã™ã€‚`:h fidget.notification.Config`ã‹ã‚‰ç´°ã‹ã„è¨­å®šãŒã§ãã¾ã™ã€‚

å±¥æ­´ã‚’è¦‹ã‚‹ã«ã¯`:Fidget history`ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§å®Ÿè¡Œã—ã¾ã™ã€‚
(ã¡ãªã¿ã«ã€å‡ºåŠ›çµæœã®ç”»é¢ã¯`:h more-prompt`ã¨å‘¼ã¶ã‚ˆã†ã§ã™ã€‚)
è‡ªåˆ†ã§å±¥æ­´ã‚’ã©ã†ã“ã†ã—ãŸã„å ´åˆã€`get_history()`ã§å±¥æ­´ã‚’å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚


æœ€å¾Œã«ã€fidgetã¯`vim.notify()`äº’æ›ãªã®ã§é€šçŸ¥ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å…¥ã‚Œæ›¿ãˆã‚‚ç°¡å˜ã§ã™ã€‚

```lua
vim.notify = require("fidget.notification").notify
```

## ãŠã‚ã‚Šã«

ä»¥ä¸Šã€ç°¡å˜ãªç´¹ä»‹ã§ã—ãŸã€‚
æ§ãˆç›®ãªé€šçŸ¥ãŒå¥½ã¿ãªã‚‰fidgetã‚’è©¦ã—ã¦ã¿ã¦ã¯ã„ã‹ã‹ã§ã—ã‚‡ã†ã‹ã€‚
